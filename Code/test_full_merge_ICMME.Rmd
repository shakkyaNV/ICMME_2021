---
title: "ICMME"
author: "eNVy"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = NULL)
# knitr::opts_chunk$set(warning = F, message = F) # Un-comment at the end
```

```{r libs}
library(tidyverse)
library(magrittr)
```


### Read Files

```{r}
# read raw
raw_df_4 <- read_csv("../Data/heavy/API_4.csv", 
                     col_names = T,
                     skip = 4)

raw_df_8 <- read_csv("../Data/heavy/API_8.csv", 
                     col_names = T, 
                     skip = 4)

ind_list <- list.files(path = "../Data/heavy/", 
                                pattern = "*indicator.csv", 
                                full.names = T)
indicator_nested_tbl <- map(ind_list, read_csv)
```

```{r}
# assign and naming
indicator_temp_names <- ind_list %>% 
  str_remove(pattern = "../Data/heavy/") %>% 
  str_remove(pattern = ".csv")

for (i in 1:length(indicator_temp_names)) {
  assign(indicator_temp_names[i], indicator_nested_tbl[[i]])
}
```


### Clean and Prep

```{r}
# remvoe unnecc cols
API_4_country_indicator %<>% select(-c(4,6)) %>% 
  rename(Code = `Country Code`, Country_name = TableName)

API_4_indicator %<>% select(1,2,3)

API_8_country_indicator %<>% select(-c(4,6)) %>% 
  rename(Code = `Country Code`, Country_name = TableName)

API_8_indicator %<>% select(1:3)
```


```{r}
# main raw files clean and prep
removecols <- c(1,3, 5:28, 63:66) # remove name columsn and prev and future years

names(raw_df_4) <- str_replace_all(names(raw_df_4), c(" " = ""))

df_4 <- raw_df_4 %>% as_tibble() %>% 
  select(-removecols)

names(raw_df_8) <- str_replace_all(names(raw_df_8), c(" " = ""))

df_8 <- raw_df_8 %>% as_tibble() %>% 
  select(-removecols)

# main df's are %>% df4 and df8
```


```{r}
doParallel::registerDoParallel()
```


```{r}
Full_8 <- df_8 %>% 
  pivot_longer(!c(IndicatorCode, CountryCode), 
               names_to = "Year", 
               values_to = "Value") 

Full_4 <- df_4 %>% 
  pivot_longer(!c(IndicatorCode, CountryCode), 
               names_to = "Year", 
               values_to = "Value")
```

